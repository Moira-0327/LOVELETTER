(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function a(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=a(n);fetch(n.href,o)}})();const B=["january","february","march","april","may","june","july","august","september","october","november","december"],s={partnerName:"",senderName:"",togetherDate:null,letterContent:"",photos:[null,null,null,null],typingActive:!1,hasPhotos:!1,expandedPanel:null,letterTyped:!1},q=document.getElementById("setup-screen"),U=document.getElementById("result-screen"),fe=document.getElementById("setup-form"),ge=document.querySelectorAll(".photo-upload-slot"),ye=document.getElementById("back-btn");document.getElementById("flatlay-scene");const ve=document.getElementById("letter-paper"),j=document.getElementById("photobooth-strip-el"),se=document.getElementById("flatlay-actions"),H=document.getElementById("expand-backdrop"),V=document.getElementById("expand-letter-panel"),X=document.getElementById("expand-photobooth-panel");let w=null,D=null,O=!1,I=null;function re(){if(w)return w;try{w=new(window.AudioContext||window.webkitAudioContext);const t=w.sampleRate,e=Math.floor(t*.03),a=w.createBuffer(1,e,t),r=a.getChannelData(0);for(let n=0;n<e;n++){const o=n/t,i=Math.exp(-o*150);r[n]=(Math.sin(o*600*6.283)*.4+(Math.random()-.5)*.15)*i*.1}D=a}catch{}if(!I)try{const a=Math.floor(661.5),r=new ArrayBuffer(44+a*2),n=new DataView(r),o=(i,c)=>{for(let d=0;d<c.length;d++)n.setUint8(i+d,c.charCodeAt(d))};o(0,"RIFF"),n.setUint32(4,36+a*2,!0),o(8,"WAVE"),o(12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,1,!0),n.setUint32(24,22050,!0),n.setUint32(28,22050*2,!0),n.setUint16(32,2,!0),n.setUint16(34,16,!0),o(36,"data"),n.setUint32(40,a*2,!0);for(let i=0;i<a;i++){const c=i/22050,d=Math.sin(c*600*6.283)*.3*Math.exp(-c*150);n.setInt16(44+i*2,Math.max(-1,Math.min(1,d))*32767,!0)}I=new Audio(URL.createObjectURL(new Blob([r],{type:"audio/wav"}))),I.volume=.15}catch{}return w}function K(){const t=re();if(t&&(t.state==="suspended"?t.resume().then(()=>{O=!0}):O=!0,D))try{const e=t.createBufferSource();e.buffer=D;const a=t.createGain();a.gain.value=.001,e.connect(a),a.connect(t.destination),e.start()}catch{}I&&I.play().then(()=>{I.pause(),I.currentTime=0}).catch(()=>{})}document.addEventListener("touchend",K,{passive:!0});document.addEventListener("click",K);document.addEventListener("keydown",K);function ie(){if(!w||!D){re();return}if(O&&w.state==="running")try{const t=w.createBufferSource();t.buffer=D,t.connect(w.destination),t.start();return}catch{}if(I)try{I.currentTime=0,I.play().catch(()=>{})}catch{}w.state==="suspended"&&w.resume().then(()=>{O=!0})}xe();let ae=!1;document.addEventListener("click",()=>{if(!ae)try{const t=getAudioContext();t.state==="suspended"&&t.resume(),ae=!0}catch{}},{once:!1});function xe(){const t=document.createElement("canvas"),e=200;t.width=e,t.height=e;const a=t.getContext("2d"),r=a.createImageData(e,e);for(let o=0;o<r.data.length;o+=4){const i=190+Math.random()*40;r.data[o]=i,r.data[o+1]=i*.93,r.data[o+2]=i*.82,r.data[o+3]=14}a.putImageData(r,0,0);for(let o=0;o<12;o++)a.fillStyle=`rgba(150,120,70,${.03+Math.random()*.05})`,a.beginPath(),a.arc(Math.random()*e,Math.random()*e,1+Math.random()*3,0,6.283),a.fill();const n=t.toDataURL("image/png");document.querySelectorAll(".paper-grain").forEach(o=>{o.style.backgroundImage=`url(${n})`,o.style.backgroundSize=`${e}px ${e}px`})}document.querySelectorAll('#setup-form input[type="text"], #setup-form input[type="date"], #setup-form textarea').forEach(t=>{t.addEventListener("input",()=>ie())});ge.forEach(t=>{const e=t.querySelector(".photo-input"),a=t.querySelector(".photo-preview"),r=parseInt(t.dataset.index);e.addEventListener("change",n=>{const o=n.target.files[0];if(!o)return;const i=new FileReader;i.onload=c=>{s.photos[r]=c.target.result,a.src=c.target.result,t.classList.add("has-photo")},i.readAsDataURL(o)})});fe.addEventListener("submit",t=>{t.preventDefault(),s.partnerName=document.getElementById("partner-name").value.trim(),s.senderName=document.getElementById("sender-name").value.trim();const e=document.getElementById("together-date").value;s.togetherDate=e?new Date(e+"T00:00:00"):new Date,s.letterContent=document.getElementById("letter-content").value.trim(),s.hasPhotos=s.photos.some(a=>a!==null),ce(),W(U)});function ce(){const t=new Date,e=t.getDate(),a=B[t.getMonth()],r=Z(s.togetherDate),n=`${a.toUpperCase().slice(0,3)} ${e}, '${String(t.getFullYear()).slice(2)}`,o=document.getElementById("stamp-date");o&&(o.textContent=n);const i=s.partnerName?`Dear ${s.partnerName},`:"Dear you,",c=s.letterContent||"You are the most beautiful chapter in my story.";document.getElementById("letter-greeting").textContent=i,document.getElementById("letter-body").textContent=c,document.getElementById("letter-sender").textContent=s.senderName?`Yours, ${s.senderName}`:"";const d=String(t.getHours()).padStart(2,"0"),m=String(t.getMinutes()).padStart(2,"0"),u=`sealed at ${d}:${m}`;if(document.getElementById("letter-seal-date").textContent=u,document.getElementById("letter-seal-date").classList.add("visible"),document.getElementById("days-stamp").innerHTML=le(r),document.getElementById("days-stamp").classList.add("visible"),s.hasPhotos){j.style.display="";const v=`${a.toUpperCase().slice(0,3)} ${e}, ${t.getFullYear()}`;document.getElementById("strip-date").textContent=v;const b=s.partnerName&&s.senderName?`${s.senderName} & ${s.partnerName}`:s.partnerName?`me & ${s.partnerName}`:"you & me";document.getElementById("strip-caption").textContent=b,s.photos.forEach((l,L)=>{const h=document.getElementById(`strip-photo-${L}`);l?h.style.backgroundImage=`url(${l})`:h.style.background="linear-gradient(135deg, #E8E0D8 0%, #D4C8BC 100%)"})}else j.style.display="none";s.letterTyped=!1,setTimeout(()=>{se.classList.add("visible")},1200)}function le(t){return`<div class="days-stamp-inner">
    <div class="stamp-heart">
      <svg viewBox="0 0 60 55" fill="none" stroke="currentColor">
        <path d="M30 50 C30 50, 4 32, 4 17 C4 8, 10 2, 18 2 C23 2, 27 5, 30 10 C33 5, 37 2, 42 2 C50 2, 56 8, 56 17 C56 32, 30 50, 30 50Z" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M30 48 C30 48, 6 31, 6 18 C6 9, 11.5 4, 18.5 4 C23 4, 27 6.5, 30 11 C33 6.5, 37 4, 41.5 4 C48.5 4, 54 9, 54 18 C54 31, 30 48, 30 48Z" stroke-width="0.8" opacity="0.4" stroke-linecap="round"/>
      </svg>
      <span class="stamp-love">LOVE</span>
    </div>
    <span class="stamp-text">${t} days of us</span>
  </div>`}function Z(t){const a=new Date-t;return Math.max(0,Math.floor(a/(1e3*60*60*24)))}ve.addEventListener("click",()=>{s.expandedPanel||Ee()});j.addEventListener("click",()=>{s.expandedPanel||we()});H.addEventListener("click",()=>{M()});V.addEventListener("click",t=>{t.target.closest(".save-btn")||M()});X.addEventListener("click",t=>{t.target.closest(".save-btn")||M()});document.addEventListener("keydown",t=>{t.key==="Escape"&&(s.expandedPanel?M():U.classList.contains("active")&&(s.typingActive=!1,W(q)))});function Ee(){s.expandedPanel="letter";const t=new Date,e=t.getDate(),a=B[t.getMonth()],r=Z(s.togetherDate),n=s.partnerName?`Dear ${s.partnerName},`:"Dear you,",o=s.letterContent||"You are the most beautiful chapter in my story.",i=document.getElementById("expand-stamp-date");i&&(i.textContent=`${a.toUpperCase().slice(0,3)} ${e}, '${String(t.getFullYear()).slice(2)}`);const c=document.getElementById("expand-letter-greeting"),d=document.getElementById("expand-letter-body"),m=document.getElementById("expand-letter-sender"),u=document.getElementById("expand-letter-seal-date"),v=s.senderName?`Yours, ${s.senderName}`:"",b=String(t.getHours()).padStart(2,"0"),l=String(t.getMinutes()).padStart(2,"0"),L=`sealed at ${b}:${l}`,h=document.getElementById("expand-days-stamp");h.innerHTML=le(r),h.classList.add("visible"),c.textContent="",d.textContent="",m.textContent="",u.textContent="",u.classList.remove("visible"),H.classList.add("active"),V.classList.add("active"),be(c,d,m,u,n,o,v,L)}function we(){s.expandedPanel="photobooth";const t=new Date,e=t.getDate(),r=`${B[t.getMonth()].toUpperCase().slice(0,3)} ${e}, ${t.getFullYear()}`;document.getElementById("expand-strip-date").textContent=r;const n=s.partnerName&&s.senderName?`${s.senderName} & ${s.partnerName}`:s.partnerName?`me & ${s.partnerName}`:"you & me";document.getElementById("expand-strip-caption").textContent=n,s.photos.forEach((o,i)=>{const c=document.getElementById(`expand-strip-photo-${i}`);o?c.style.backgroundImage=`url(${o})`:c.style.background="linear-gradient(135deg, #E8E0D8 0%, #D4C8BC 100%)"}),H.classList.add("active"),X.classList.add("active")}function M(){s.typingActive=!1,s.expandedPanel=null,H.classList.remove("active"),V.classList.remove("active"),X.classList.remove("active")}async function be(t,e,a,r,n,o,i,c){s.typingActive=!0,await $(500),s.typingActive&&(t.classList.add("typing-cursor"),await z(t,n,50),t.classList.remove("typing-cursor"),s.typingActive&&(await $(400),e.classList.add("typing-cursor"),await z(e,o,40),e.classList.remove("typing-cursor"),s.typingActive&&(i&&(await $(300),a.classList.add("typing-cursor"),await z(a,i,50),a.classList.remove("typing-cursor"),!s.typingActive)||(await $(300),r.textContent=c,r.classList.add("visible"),s.letterTyped=!0))))}function z(t,e,a){return new Promise(r=>{let n=0,o=0;t.textContent="";function i(c){if(!s.typingActive||n>=e.length){t.textContent=e,r();return}if(c>=o){t.textContent+=e.charAt(n),ie();const d=e.charAt(n);let m=a+Math.random()*20-10;d==="."||d==="!"||d==="?"?m+=180:d===","?m+=80:d===`
`&&(m+=120),o=c+m,n++}requestAnimationFrame(i)}requestAnimationFrame(i)})}function $(t){return new Promise(e=>setTimeout(e,t))}const oe="#EAE2D3",de="#FFF8F0",P="#C0392B",ue="#8A7A76",Se="#C0392B",Ie="#961C14",Le="#D4817A";function Pe(t){return new Promise((e,a)=>{const r=new Image;r.onload=()=>e(r),r.onerror=a,r.src=t})}function Ce(t,e,a,r,n,o){const i=Math.max(n/e.width,o/e.height),c=e.width*i,d=e.height*i;t.save(),t.beginPath(),t.rect(a,r,n,o),t.clip(),t.drawImage(e,a+(n-c)/2,r+(o-d)/2,c,d),t.restore()}async function _(t,e){const a=await new Promise(c=>t.toBlob(c,"image/png")),r=document.getElementById("share-toast");if(navigator.share&&navigator.canShare)try{const d={files:[new File([a],e,{type:"image/png"})]};if(navigator.canShare(d)){await navigator.share(d);return}}catch{}const n=URL.createObjectURL(a),o=document.createElement("a");o.download=e,o.href=n,document.body.appendChild(o),o.click(),document.body.removeChild(o),/iPad|iPhone|iPod/.test(navigator.userAgent)?(window.open(n,"_blank"),r.textContent="Long press image to save",r.classList.add("visible"),setTimeout(()=>r.classList.remove("visible"),3e3)):setTimeout(()=>URL.revokeObjectURL(n),5e3)}const E=850,T=1100,p=3;document.getElementById("btn-save").addEventListener("click",async t=>{t.preventDefault(),t.stopPropagation();const e=J();if(await _(e,"love-letter.png"),s.hasPhotos){const a=await Q();await _(a,"photobooth.png")}});document.getElementById("expand-save-letter").addEventListener("click",async t=>{t.preventDefault(),t.stopPropagation();const e=J();await _(e,"love-letter.png")});document.getElementById("expand-save-photobooth").addEventListener("click",async t=>{t.preventDefault(),t.stopPropagation();const e=await Q();await _(e,"photobooth.png")});function J(){const t=document.createElement("canvas");t.width=E*p,t.height=T*p;const e=t.getContext("2d");e.scale(p,p),e.fillStyle=oe,e.fillRect(0,0,E,T);const a=e.createRadialGradient(E/2,T/2,E*.3,E/2,T/2,E*.7);a.addColorStop(0,"rgba(0,0,0,0)"),a.addColorStop(1,"rgba(140,110,60,0.08)"),e.fillStyle=a,e.fillRect(0,0,E,T);for(let y=0;y<15;y++){const G=Math.random()*E,S=Math.random()*T,k=2+Math.random()*8;e.fillStyle=`rgba(160,130,70,${.02+Math.random()*.04})`,e.beginPath(),e.arc(G,S,k,0,Math.PI*2),e.fill()}const r=80;let n=r;const o=s.partnerName?`Dear ${s.partnerName},`:"Dear you,";e.font='28px "Special Elite", "Courier New", monospace',e.fillStyle=P,e.fillText(o,r,n),n+=50;const i=s.letterContent||"You are the most beautiful chapter in my story.";e.font='22px "Special Elite", "Courier New", monospace',e.fillStyle=P;const c=E-r*2,d=44,m=i.split(`
`);for(const y of m){const G=y.split(" ");let S="";for(const k of G){const ne=S+(S?" ":"")+k;e.measureText(ne).width>c&&S?(e.fillText(S,r,n),n+=d,S=k):S=ne}S&&(e.fillText(S,r,n),n+=d),n+=8}s.senderName&&(n+=20,e.font='38px "Mrs Saint Delafield", cursive',e.fillStyle=P,e.textAlign="right",e.fillText(`Yours, ${s.senderName}`,E-r,n),e.textAlign="left",n+=48);const u=new Date,v=String(u.getHours()).padStart(2,"0"),b=String(u.getMinutes()).padStart(2,"0"),l=`SEALED AT ${v}:${b}`;e.font='14px "Special Elite", "Courier New", monospace',e.fillStyle=ue,e.textAlign="right",e.fillText(l,E-r,n),e.textAlign="left";const L=Z(s.togetherDate),h=150,x=165,g=E-r-h,f=T-r-x,C=12;e.save(),e.fillStyle=de,e.fillRect(g,f,h,x),e.fillStyle=oe;const N=16,R=5;for(let y=g+N/2;y<g+h;y+=N)e.beginPath(),e.arc(y,f,R,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(y,f+x,R,0,Math.PI*2),e.fill();for(let y=f+N/2;y<f+x;y+=N)e.beginPath(),e.arc(g,y,R,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(g+h,y,R,0,Math.PI*2),e.fill();e.fillStyle=Le,e.fillRect(g+C,f+C,h-C*2,x-C*2);const F=g+h/2,ee=f+C+(x-C*2)*.48,te=2.8;e.save(),e.translate(F,ee),e.scale(te,te),e.beginPath(),e.moveTo(0,14),e.bezierCurveTo(-2,10,-18,-2,-18,-10),e.bezierCurveTo(-18,-18,-10,-22,0,-14),e.bezierCurveTo(10,-22,18,-18,18,-10),e.bezierCurveTo(18,-2,2,10,0,14),e.closePath(),e.strokeStyle=P,e.lineWidth=1,e.stroke(),e.beginPath(),e.moveTo(0,11),e.bezierCurveTo(-2,8,-15,-1,-15,-8),e.bezierCurveTo(-15,-15,-8,-18,0,-11),e.bezierCurveTo(8,-18,15,-15,15,-8),e.bezierCurveTo(15,-1,2,8,0,11),e.closePath(),e.lineWidth=.5,e.globalAlpha=.5,e.stroke(),e.globalAlpha=1,e.restore(),e.fillStyle=P,e.font='600 18px "Playfair Display", Georgia, serif',e.textAlign="center",e.textBaseline="middle",e.fillText("LOVE",F,ee-4),e.font='16px "Mrs Saint Delafield", cursive',e.fillText(`${L} days of us`,F,f+x-C-12),e.textAlign="left",e.textBaseline="top",e.restore();const me=E-r-55,pe=r+15,A=55;e.save(),e.translate(me,pe),e.rotate(.2),e.strokeStyle=P,e.lineWidth=2,e.beginPath(),e.arc(0,0,A,0,Math.PI*2),e.stroke(),e.lineWidth=1,e.beginPath(),e.arc(0,0,A-7,0,Math.PI*2),e.stroke(),e.lineWidth=1.5,e.beginPath(),e.moveTo(-A-6,0),e.lineTo(-A,0),e.stroke(),e.beginPath(),e.moveTo(A,0),e.lineTo(A+6,0),e.stroke(),e.fillStyle=P,e.font='400 8px "DM Sans", sans-serif',e.textAlign="center",e.textBaseline="middle",e.fillText("LOVE LETTER",0,-16);const Y=new Date,he=`${B[Y.getMonth()].toUpperCase().slice(0,3)} ${Y.getDate()}, '${String(Y.getFullYear()).slice(2)}`;return e.font='500 12px "DM Sans", sans-serif',e.fillText(he,0,2),e.font='300 7px "DM Sans", sans-serif',e.fillText("NEW YORK, NY",0,18),e.restore(),t}async function Q(){const n=Math.round(405),o=12,i=50,c=50,d=i+n*4+o*3+c,m=document.createElement("canvas");m.width=600,m.height=d;const u=m.getContext("2d");u.fillStyle=de,u.fillRect(0,0,600,d);const v=new Date,b=`${B[v.getMonth()].toUpperCase().slice(0,3)} ${v.getDate()}, ${v.getFullYear()}`;u.font='400 11px "DM Sans", "Helvetica Neue", sans-serif',u.fillStyle=ue,u.textAlign="center",u.textBaseline="middle",u.fillText(b,600/2,i/2);let l=i;for(let h=0;h<4;h++){if(s.photos[h])try{const x=await Pe(s.photos[h]),g=document.createElement("canvas");g.width=540,g.height=n;const f=g.getContext("2d");f.filter="grayscale(100%) contrast(1.1) brightness(1.05)",Ce(f,x,0,0,540,n),u.drawImage(g,30,l,540,n)}catch{u.fillStyle="#F5EDE0",u.fillRect(30,l,540,n)}else u.fillStyle="#F5EDE0",u.fillRect(30,l,540,n);l+=n+o}const L=s.partnerName&&s.senderName?`${s.senderName} & ${s.partnerName}`:s.partnerName?`me & ${s.partnerName}`:"you & me";return u.font='400 12px "DM Sans", "Helvetica Neue", sans-serif',u.fillStyle=P,u.textAlign="center",u.textBaseline="middle",u.fillText(L.toUpperCase(),600/2,l-o+c/2),m}document.getElementById("btn-share").addEventListener("click",async t=>{t.preventDefault(),t.stopPropagation();const e=document.getElementById("share-toast"),a=window.location.origin+window.location.pathname;if(navigator.share)try{await navigator.share({title:"Love Letter",url:a});return}catch{}try{await navigator.clipboard.writeText(a),e.textContent="Link copied"}catch{e.textContent=a}e.classList.add("visible"),setTimeout(()=>e.classList.remove("visible"),2200)});document.getElementById("btn-send").addEventListener("click",async t=>{t.stopPropagation();const e=document.getElementById("share-toast"),a=J();let r=null;s.hasPhotos&&(r=await Q());const n=Te(a,r),o=await new Promise(m=>n.toBlob(m,"image/png"));if(navigator.share&&navigator.canShare){const u={files:[new File([o],"lover-letter.png",{type:"image/png"})],title:"Love Letter"};if(navigator.canShare(u))try{await navigator.share(u);return}catch{}}const i=URL.createObjectURL(o),c=document.createElement("a");c.download="lover-letter.png",c.href=i,document.body.appendChild(c),c.click(),document.body.removeChild(c),/iPad|iPhone|iPod/.test(navigator.userAgent)?(window.open(i,"_blank"),e.textContent="Long press image to save & send",e.classList.add("visible"),setTimeout(()=>e.classList.remove("visible"),3e3)):(e.textContent="Image saved â€” send it to them!",e.classList.add("visible"),setTimeout(()=>e.classList.remove("visible"),2500),setTimeout(()=>URL.revokeObjectURL(i),5e3))});function Te(t,e){const r=document.createElement("canvas");if(!e){const x=t.width/p+80,g=t.height/p+80;r.width=x*p,r.height=g*p;const f=r.getContext("2d");return f.scale(p,p),f.fillStyle=Se,f.fillRect(0,0,x,g),f.drawImage(t,0,0,t.width,t.height,40,40,t.width/p,t.height/p),r}const n=t.width/p,o=t.height/p,i=e.width/p,c=e.height/p,d=Math.min(o*.7/c,n*.5/i),m=i*d,u=c*d,v=n+m+120,b=Math.max(o,u)+80;r.width=v*p,r.height=b*p;const l=r.getContext("2d");l.scale(p,p),l.fillStyle=Ie,l.fillRect(0,0,v,b),l.save(),l.translate(40+n/2,40+o/2),l.rotate(-.01),l.shadowColor="rgba(0,0,0,0.2)",l.shadowBlur=15,l.shadowOffsetX=4,l.shadowOffsetY=4,l.drawImage(t,0,0,t.width,t.height,-n/2,-o/2,n,o),l.restore(),l.save();const L=80+n+m/2,h=b/2;return l.translate(L,h),l.rotate(.03),l.shadowColor="rgba(0,0,0,0.3)",l.shadowBlur=20,l.shadowOffsetX=5,l.shadowOffsetY=5,l.drawImage(e,0,0,e.width,e.height,-m/2,-u/2,m,u),l.restore(),r}function W(t){q.classList.remove("active"),U.classList.remove("active"),t.classList.add("active")}ye.addEventListener("click",()=>{if(s.expandedPanel){M();return}s.typingActive=!1,se.classList.remove("visible"),W(q)});function Ae(t){try{const e=decodeURIComponent(escape(atob(t)));return JSON.parse(e)}catch{return null}}(function(){const e=window.location.hash.slice(1);if(!e)return;const a=Ae(e);a&&(a.n&&(document.getElementById("partner-name").value=a.n,s.partnerName=a.n),a.s&&(document.getElementById("sender-name").value=a.s,s.senderName=a.s),a.d&&(document.getElementById("together-date").value=a.d,s.togetherDate=new Date(a.d+"T00:00:00")),a.l&&(document.getElementById("letter-content").value=a.l,s.letterContent=a.l),s.hasPhotos=!1,ce(),W(U))})();
