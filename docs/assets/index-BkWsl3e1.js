(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();const ht="/lover-letter/assets/paper-texture-CsZFBrw6.png",R=["january","february","march","april","may","june","july","august","september","october","november","december"],a={partnerName:"",senderName:"",togetherDate:null,letterContent:"",photos:[null,null,null,null],typingActive:!1,hasPhotos:!1,expandedPanel:null,letterTyped:!1},J=document.getElementById("setup-screen"),Y=document.getElementById("result-screen"),ft=document.getElementById("setup-form"),X=document.getElementById("photo-input-multi"),it=document.querySelectorAll(".photo-upload-slot"),yt=document.getElementById("back-btn");document.getElementById("flatlay-scene");const vt=document.getElementById("letter-paper"),K=document.getElementById("photobooth-strip-el"),lt=document.getElementById("flatlay-actions"),G=document.getElementById("expand-backdrop"),Z=document.getElementById("expand-letter-panel"),Q=document.getElementById("expand-photobooth-panel");let b=null,k=null,W=!1,T=null;function tt(){if(b)return b;try{b=new(window.AudioContext||window.webkitAudioContext);const e=b.sampleRate,t=Math.floor(e*.03),o=b.createBuffer(1,t,e),r=o.getChannelData(0);for(let n=0;n<t;n++){const s=n/e,i=Math.exp(-s*150);r[n]=(Math.sin(s*600*6.283)*.4+(Math.random()-.5)*.15)*i*.1}k=o}catch{}if(!T)try{const o=Math.floor(661.5),r=new ArrayBuffer(44+o*2),n=new DataView(r),s=(i,l)=>{for(let c=0;c<l.length;c++)n.setUint8(i+c,l.charCodeAt(c))};s(0,"RIFF"),n.setUint32(4,36+o*2,!0),s(8,"WAVE"),s(12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,1,!0),n.setUint32(24,22050,!0),n.setUint32(28,22050*2,!0),n.setUint16(32,2,!0),n.setUint16(34,16,!0),s(36,"data"),n.setUint32(40,o*2,!0);for(let i=0;i<o;i++){const l=i/22050,c=Math.sin(l*600*6.283)*.3*Math.exp(-l*150);n.setInt16(44+i*2,Math.max(-1,Math.min(1,c))*32767,!0)}T=new Audio(URL.createObjectURL(new Blob([r],{type:"audio/wav"}))),T.volume=.15}catch{}return b}function et(){const e=tt();if(e&&(e.state==="suspended"?e.resume().then(()=>{W=!0}):W=!0,k))try{const t=e.createBufferSource();t.buffer=k;const o=e.createGain();o.gain.value=.001,t.connect(o),o.connect(e.destination),t.start()}catch{}T&&T.play().then(()=>{T.pause(),T.currentTime=0}).catch(()=>{})}document.addEventListener("touchend",et,{passive:!0});document.addEventListener("click",et);document.addEventListener("keydown",et);function ct(){if(!b||!k){tt();return}if(W&&b.state==="running")try{const e=b.createBufferSource();e.buffer=k,e.connect(b.destination),e.start();return}catch{}if(T)try{T.currentTime=0,T.play().catch(()=>{})}catch{}b.state==="suspended"&&b.resume().then(()=>{W=!0})}const z=document.getElementById("together-date");z.addEventListener("change",()=>{z.classList.toggle("has-value",!!z.value)});xt();let rt=!1;document.addEventListener("click",()=>{if(!rt)try{const e=tt();e&&e.state==="suspended"&&e.resume(),rt=!0}catch{}},{once:!1});function xt(){const e=document.createElement("canvas"),t=200;e.width=t,e.height=t;const o=e.getContext("2d"),r=o.createImageData(t,t);for(let s=0;s<r.data.length;s+=4){const i=190+Math.random()*40;r.data[s]=i,r.data[s+1]=i*.93,r.data[s+2]=i*.82,r.data[s+3]=14}o.putImageData(r,0,0);for(let s=0;s<12;s++)o.fillStyle=`rgba(150,120,70,${.03+Math.random()*.05})`,o.beginPath(),o.arc(Math.random()*t,Math.random()*t,1+Math.random()*3,0,6.283),o.fill();const n=e.toDataURL("image/png");document.querySelectorAll(".paper-grain").forEach(s=>{s.style.backgroundImage=`url(${n})`,s.style.backgroundSize=`${t}px ${t}px`})}document.querySelectorAll('#setup-form input[type="text"], #setup-form input[type="date"], #setup-form textarea').forEach(e=>{e.addEventListener("input",()=>ct())});function dt(e){const t=it[e],o=t.querySelector(".photo-preview");a.photos[e]?(o.src=a.photos[e],t.classList.add("filled")):(o.src="",t.classList.remove("filled"))}it.forEach((e,t)=>{e.addEventListener("click",()=>{a.photos[t]?(a.photos[t]=null,dt(t)):X.click()})});X.addEventListener("change",e=>{const t=Array.from(e.target.files),o=a.photos.filter(n=>n!==null).length,r=Math.min(t.length,4-o);for(let n=0;n<r;n++){const s=new FileReader,i=a.photos.indexOf(null);if(i===-1)break;s.onload=(l=>c=>{a.photos[l]=c.target.result,dt(l)})(i),s.readAsDataURL(t[n])}X.value=""});ft.addEventListener("submit",e=>{e.preventDefault(),a.partnerName=document.getElementById("partner-name").value.trim(),a.senderName=document.getElementById("sender-name").value.trim();const t=document.getElementById("together-date").value;a.togetherDate=t?new Date(t+"T00:00:00"):new Date,a.letterContent=document.getElementById("letter-content").value.trim(),a.hasPhotos=a.photos.some(o=>o!==null),mt(),j(Y)});function mt(){const e=new Date,t=e.getDate(),o=R[e.getMonth()],r=nt(a.togetherDate),n=`${o.toUpperCase().slice(0,3)} ${t}, '${String(e.getFullYear()).slice(2)}`,s=document.getElementById("stamp-date");s&&(s.textContent=n);const i=a.partnerName?`Dear ${a.partnerName},`:"Dear you,",l=a.letterContent||"You are the most beautiful chapter in my story.";document.getElementById("letter-greeting").textContent=i,document.getElementById("letter-body").textContent=l,document.getElementById("letter-sender").textContent=a.senderName?`Yours, ${a.senderName}`:"";const c=String(e.getHours()).padStart(2,"0"),u=String(e.getMinutes()).padStart(2,"0"),m=`sealed at ${c}:${u}`;if(document.getElementById("letter-seal-date").textContent=m,document.getElementById("letter-seal-date").classList.add("visible"),document.getElementById("days-stamp").innerHTML=ut(r),document.getElementById("days-stamp").classList.add("visible"),a.hasPhotos){K.style.display="";const x=`${o.toUpperCase().slice(0,3)} ${t}, ${e.getFullYear()}`;document.getElementById("strip-date").textContent=x;const I=a.partnerName&&a.senderName?`${a.senderName} & ${a.partnerName}`:a.partnerName?`me & ${a.partnerName}`:"you & me";document.getElementById("strip-caption").textContent=I,a.photos.forEach((d,L)=>{const y=document.getElementById(`strip-photo-${L}`);d?y.style.backgroundImage=`url(${d})`:y.style.background="linear-gradient(135deg, #E8E0D8 0%, #D4C8BC 100%)"})}else K.style.display="none";a.letterTyped=!1,setTimeout(()=>{lt.classList.add("visible")},1200)}function ut(e){return`<svg class="rect-stamp-svg" viewBox="0 0 170 90" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g opacity="0.7" transform="rotate(-1.5 85 45)">
      <rect x="2" y="2" width="166" height="86" rx="1" stroke="currentColor" stroke-width="2.5"/>
      <rect x="8" y="8" width="154" height="74" rx="1" stroke="currentColor" stroke-width="1"/>
      <text x="85" y="24" text-anchor="middle" font-family="'DM Sans',sans-serif" font-size="12" font-weight="500" letter-spacing="2" fill="currentColor">${e} DAYS</text>
      <line x1="16" y1="45" x2="58" y2="45" stroke="currentColor" stroke-width="1" opacity="0.6"/>
      <line x1="112" y1="45" x2="154" y2="45" stroke="currentColor" stroke-width="1" opacity="0.6"/>
      <text x="85" y="49" text-anchor="middle" font-family="'Playfair Display',Georgia,serif" font-size="17" font-weight="600" letter-spacing="2" fill="currentColor">LOVE</text>
      <text x="85" y="73" text-anchor="middle" font-family="'DM Sans',sans-serif" font-size="12" font-weight="500" letter-spacing="3" fill="currentColor">OF US</text>
    </g>
  </svg>`}function nt(e){const o=new Date-e;return Math.max(0,Math.floor(o/(1e3*60*60*24)))}vt.addEventListener("click",()=>{a.expandedPanel||wt()});K.addEventListener("click",()=>{a.expandedPanel||Et()});G.addEventListener("click",()=>{$()});Z.addEventListener("click",e=>{e.target.closest(".save-btn")||$()});Q.addEventListener("click",e=>{e.target.closest(".save-btn")||$()});document.addEventListener("keydown",e=>{e.key==="Escape"&&(a.expandedPanel?$():Y.classList.contains("active")&&(a.typingActive=!1,j(J)))});function wt(){a.expandedPanel="letter";const e=new Date,t=e.getDate(),o=R[e.getMonth()],r=nt(a.togetherDate),n=a.partnerName?`Dear ${a.partnerName},`:"Dear you,",s=a.letterContent||"You are the most beautiful chapter in my story.",i=document.getElementById("expand-stamp-date");i&&(i.textContent=`${o.toUpperCase().slice(0,3)} ${t}, '${String(e.getFullYear()).slice(2)}`);const l=document.getElementById("expand-letter-greeting"),c=document.getElementById("expand-letter-body"),u=document.getElementById("expand-letter-sender"),m=document.getElementById("expand-letter-seal-date"),x=a.senderName?`Yours, ${a.senderName}`:"",I=String(e.getHours()).padStart(2,"0"),d=String(e.getMinutes()).padStart(2,"0"),L=`sealed at ${I}:${d}`,y=document.getElementById("expand-days-stamp");y.innerHTML=ut(r),y.classList.add("visible"),l.textContent="",c.textContent="",u.textContent="",m.textContent="",m.classList.remove("visible"),G.classList.add("active"),Z.classList.add("active"),St(l,c,u,m,n,s,x,L)}function Et(){a.expandedPanel="photobooth";const e=new Date,t=e.getDate(),r=`${R[e.getMonth()].toUpperCase().slice(0,3)} ${t}, ${e.getFullYear()}`;document.getElementById("expand-strip-date").textContent=r;const n=a.partnerName&&a.senderName?`${a.senderName} & ${a.partnerName}`:a.partnerName?`me & ${a.partnerName}`:"you & me";document.getElementById("expand-strip-caption").textContent=n,a.photos.forEach((s,i)=>{const l=document.getElementById(`expand-strip-photo-${i}`);s?l.style.backgroundImage=`url(${s})`:l.style.background="linear-gradient(135deg, #E8E0D8 0%, #D4C8BC 100%)"}),G.classList.add("active"),Q.classList.add("active")}function $(){a.typingActive=!1,a.expandedPanel=null,G.classList.remove("active"),Z.classList.remove("active"),Q.classList.remove("active")}async function St(e,t,o,r,n,s,i,l){a.typingActive=!0,await U(500),a.typingActive&&(e.classList.add("typing-cursor"),await V(e,n,50),e.classList.remove("typing-cursor"),a.typingActive&&(await U(400),t.classList.add("typing-cursor"),await V(t,s,40),t.classList.remove("typing-cursor"),a.typingActive&&(i&&(await U(300),o.classList.add("typing-cursor"),await V(o,i,50),o.classList.remove("typing-cursor"),!a.typingActive)||(await U(300),r.textContent=l,r.classList.add("visible"),a.letterTyped=!0))))}function V(e,t,o){return new Promise(r=>{let n=0,s=0;e.textContent="";function i(l){if(!a.typingActive||n>=t.length){e.textContent=t,r();return}if(l>=s){e.textContent+=t.charAt(n),ct();const c=t.charAt(n);let u=o+Math.random()*20-10;c==="."||c==="!"||c==="?"?u+=180:c===","?u+=80:c===`
`&&(u+=120),s=l+u,n++}requestAnimationFrame(i)}requestAnimationFrame(i)})}function U(e){return new Promise(t=>setTimeout(t,e))}const H=new Image;H.src=ht;const bt="#E2D9CC",B="#C0392B",It="#C0392B",pt="#961C14";function Lt(e){return new Promise((t,o)=>{const r=new Image;r.onload=()=>t(r),r.onerror=o,r.src=e})}function Pt(e,t,o,r,n,s){const i=Math.max(n/t.width,s/t.height),l=t.width*i,c=t.height*i;e.save(),e.beginPath(),e.rect(o,r,n,s),e.clip(),e.drawImage(t,o+(n-l)/2,r+(s-c)/2,l,c),e.restore()}async function F(e,t){const o=await new Promise(l=>e.toBlob(l,"image/png")),r=document.getElementById("share-toast");if(navigator.share&&navigator.canShare)try{const c={files:[new File([o],t,{type:"image/png"})]};if(navigator.canShare(c)){await navigator.share(c);return}}catch{}const n=URL.createObjectURL(o),s=document.createElement("a");s.download=t,s.href=n,document.body.appendChild(s),s.click(),document.body.removeChild(s),/iPad|iPhone|iPod/.test(navigator.userAgent)?(window.open(n,"_blank"),r.textContent="Long press image to save",r.classList.add("visible"),setTimeout(()=>r.classList.remove("visible"),3e3)):setTimeout(()=>URL.revokeObjectURL(n),5e3)}const w=850,M=1100,p=3;document.getElementById("btn-save").addEventListener("click",async e=>{e.preventDefault(),e.stopPropagation();const t=at();if(await F(t,"love-letter.png"),a.hasPhotos){const o=await ot();await F(o,"photobooth.png")}});document.getElementById("expand-save-letter").addEventListener("click",async e=>{e.preventDefault(),e.stopPropagation();const t=at();await F(t,"love-letter.png")});document.getElementById("expand-save-photobooth").addEventListener("click",async e=>{e.preventDefault(),e.stopPropagation();const t=await ot();await F(t,"photobooth.png")});function at(){const e=document.createElement("canvas");e.width=w*p,e.height=M*p;const t=e.getContext("2d");if(t.scale(p,p),H.complete&&H.naturalWidth){const P=t.createPattern(H,"repeat");t.fillStyle=P}else t.fillStyle=bt;t.fillRect(0,0,w,M);const o=t.createRadialGradient(w/2,M/2,w*.3,w/2,M/2,w*.7);o.addColorStop(0,"rgba(0,0,0,0)"),o.addColorStop(1,"rgba(140,110,60,0.08)"),t.fillStyle=o,t.fillRect(0,0,w,M);for(let P=0;P<15;P++){const O=Math.random()*w,S=Math.random()*M,_=2+Math.random()*8;t.fillStyle=`rgba(160,130,70,${.02+Math.random()*.04})`,t.beginPath(),t.arc(O,S,_,0,Math.PI*2),t.fill()}const r=80;let n=r;const s=a.partnerName?`Dear ${a.partnerName},`:"Dear you,";t.font='28px "Special Elite", "Courier New", monospace',t.fillStyle=B,t.fillText(s,r,n),n+=50;const i=a.letterContent||"You are the most beautiful chapter in my story.";t.font='22px "Special Elite", "Courier New", monospace',t.fillStyle=B;const l=w-r*2,c=44,u=i.split(`
`);for(const P of u){const O=P.split(" ");let S="";for(const _ of O){const st=S+(S?" ":"")+_;t.measureText(st).width>l&&S?(t.fillText(S,r,n),n+=c,S=_):S=st}S&&(t.fillText(S,r,n),n+=c),n+=8}a.senderName&&(n+=20,t.font='22px "Special Elite", "Courier New", monospace',t.fillStyle=B,t.textAlign="right",t.fillText(`Yours, ${a.senderName}`,w-r,n),t.textAlign="left",n+=36);const m=new Date,x=String(m.getHours()).padStart(2,"0"),I=String(m.getMinutes()).padStart(2,"0"),d=`SEALED AT ${x}:${I}`;t.font='14px "Special Elite", "Courier New", monospace',t.fillStyle=B,t.textAlign="right",t.fillText(d,w-r,n),t.textAlign="left";const L="#165dad",y=nt(a.togetherDate),E=170,v=90,g=w-r-E-5,C=M-r-v-5;t.save(),t.translate(g+E/2,C+v/2),t.rotate(-.06),t.translate(-680,-970),t.strokeStyle=L,t.fillStyle=L;for(let P=0;P<3;P++){const O=(Math.random()-.5)*1.2,S=(Math.random()-.5)*1.2;t.save(),t.translate(O,S),t.globalAlpha=P===0?.65:.12,t.lineWidth=2.5,t.strokeRect(g,C,E,v),t.lineWidth=1,t.strokeRect(g+6,C+6,E-12,v-12),t.restore()}t.globalAlpha=.7,t.fillStyle=L,t.textAlign="center",t.textBaseline="middle";const h=g+E/2,D=C+v/2;t.font='500 12px "DM Sans", sans-serif',t.letterSpacing="2px",t.fillText(`${y} DAYS`,h,C+20),t.letterSpacing="0px",t.lineWidth=1,t.globalAlpha=.5,t.beginPath(),t.moveTo(g+12,D),t.lineTo(h-26,D),t.stroke(),t.beginPath(),t.moveTo(h+26,D),t.lineTo(g+E-12,D),t.stroke(),t.globalAlpha=.7,t.font='600 17px "Playfair Display", Georgia, serif',t.fillText("LOVE",h,D),t.font='500 12px "DM Sans", sans-serif',t.letterSpacing="3px",t.fillText("OF US",h,C+v-20),t.letterSpacing="0px",t.globalAlpha=1,t.textAlign="left",t.textBaseline="top",t.restore();const f=w-r-55,N=r+15,A=55;t.save(),t.translate(f,N),t.rotate(.2),t.strokeStyle=B,t.lineWidth=2,t.beginPath(),t.arc(0,0,A,0,Math.PI*2),t.stroke(),t.lineWidth=1,t.beginPath(),t.arc(0,0,A-7,0,Math.PI*2),t.stroke(),t.lineWidth=1.5,t.beginPath(),t.moveTo(-A-6,0),t.lineTo(-A,0),t.stroke(),t.beginPath(),t.moveTo(A,0),t.lineTo(A+6,0),t.stroke(),t.fillStyle=B,t.font='400 8px "DM Sans", sans-serif',t.textAlign="center",t.textBaseline="middle",t.fillText("LOVE LETTER",0,-16);const q=new Date,gt=`${R[q.getMonth()].toUpperCase().slice(0,3)} ${q.getDate()}, '${String(q.getFullYear()).slice(2)}`;return t.font='500 12px "DM Sans", sans-serif',t.fillText(gt,0,2),t.font='300 7px "DM Sans", sans-serif',t.fillText("NEW YORK, NY",0,18),t.restore(),e}async function ot(){const n=Math.round(405),s=12,i=50,l=50,c=i+n*4+s*3+l,u=document.createElement("canvas");u.width=600,u.height=c;const m=u.getContext("2d");m.fillStyle=pt,m.fillRect(0,0,600,c);const x=new Date,I=`${R[x.getMonth()].toUpperCase().slice(0,3)} ${x.getDate()}, ${x.getFullYear()}`;m.font='400 11px "DM Sans", "Helvetica Neue", sans-serif',m.fillStyle="#FDF6F2",m.textAlign="center",m.textBaseline="middle",m.fillText(I,600/2,i/2);let d=i;for(let y=0;y<4;y++){if(a.photos[y])try{const E=await Lt(a.photos[y]),v=document.createElement("canvas");v.width=540,v.height=n;const g=v.getContext("2d");g.filter="grayscale(100%) contrast(1.15) brightness(1.0) sepia(8%)",Pt(g,E,0,0,540,n);const C=g.getImageData(0,0,540,n),h=C.data;for(let f=0;f<h.length;f+=4){h[f]=20+h[f]*.92,h[f+1]=20+h[f+1]*.92,h[f+2]=20+h[f+2]*.92;const N=(Math.random()-.5)*25;h[f]=Math.max(0,Math.min(255,h[f]+N)),h[f+1]=Math.max(0,Math.min(255,h[f+1]+N)),h[f+2]=Math.max(0,Math.min(255,h[f+2]+N))}g.putImageData(C,0,0);const D=g.createRadialGradient(540/2,n/2,540*.25,540/2,n/2,540*.7);D.addColorStop(0,"rgba(0,0,0,0)"),D.addColorStop(1,"rgba(0,0,0,0.4)"),g.fillStyle=D,g.fillRect(0,0,540,n),m.drawImage(v,30,d,540,n)}catch{m.fillStyle="#F5EDE0",m.fillRect(30,d,540,n)}else m.fillStyle="#F5EDE0",m.fillRect(30,d,540,n);d+=n+s}const L=a.partnerName&&a.senderName?`${a.senderName} & ${a.partnerName}`:a.partnerName?`me & ${a.partnerName}`:"you & me";return m.font='400 12px "DM Sans", "Helvetica Neue", sans-serif',m.fillStyle="#FDF6F2",m.textAlign="center",m.textBaseline="middle",m.fillText(L.toUpperCase(),600/2,d-s+l/2),u}document.getElementById("btn-share").addEventListener("click",async e=>{e.preventDefault(),e.stopPropagation();const t=document.getElementById("share-toast"),o=window.location.origin+window.location.pathname;if(navigator.share)try{await navigator.share({title:"Love Letter",url:o});return}catch{}try{await navigator.clipboard.writeText(o),t.textContent="Link copied"}catch{t.textContent=o}t.classList.add("visible"),setTimeout(()=>t.classList.remove("visible"),2200)});document.getElementById("btn-send").addEventListener("click",async e=>{e.stopPropagation();const t=document.getElementById("share-toast"),o=at();let r=null;a.hasPhotos&&(r=await ot());const n=Tt(o,r),s=await new Promise(u=>n.toBlob(u,"image/png"));if(navigator.share&&navigator.canShare){const m={files:[new File([s],"lover-letter.png",{type:"image/png"})],title:"Love Letter"};if(navigator.canShare(m))try{await navigator.share(m);return}catch{}}const i=URL.createObjectURL(s),l=document.createElement("a");l.download="lover-letter.png",l.href=i,document.body.appendChild(l),l.click(),document.body.removeChild(l),/iPad|iPhone|iPod/.test(navigator.userAgent)?(window.open(i,"_blank"),t.textContent="Long press image to save & send",t.classList.add("visible"),setTimeout(()=>t.classList.remove("visible"),3e3)):(t.textContent="Image saved â€” send it to them!",t.classList.add("visible"),setTimeout(()=>t.classList.remove("visible"),2500),setTimeout(()=>URL.revokeObjectURL(i),5e3))});function Tt(e,t){const r=document.createElement("canvas");if(!t){const E=e.width/p+80,v=e.height/p+80;r.width=E*p,r.height=v*p;const g=r.getContext("2d");return g.scale(p,p),g.fillStyle=It,g.fillRect(0,0,E,v),g.drawImage(e,0,0,e.width,e.height,40,40,e.width/p,e.height/p),r}const n=e.width/p,s=e.height/p,i=t.width/p,l=t.height/p,c=Math.min(s*.7/l,n*.5/i),u=i*c,m=l*c,x=n+u+120,I=Math.max(s,m)+80;r.width=x*p,r.height=I*p;const d=r.getContext("2d");d.scale(p,p),d.fillStyle=pt,d.fillRect(0,0,x,I),d.save(),d.translate(40+n/2,40+s/2),d.rotate(-.01),d.shadowColor="rgba(0,0,0,0.2)",d.shadowBlur=15,d.shadowOffsetX=4,d.shadowOffsetY=4,d.drawImage(e,0,0,e.width,e.height,-n/2,-s/2,n,s),d.restore(),d.save();const L=80+n+u/2,y=I/2;return d.translate(L,y),d.rotate(.03),d.shadowColor="rgba(0,0,0,0.3)",d.shadowBlur=20,d.shadowOffsetX=5,d.shadowOffsetY=5,d.drawImage(t,0,0,t.width,t.height,-u/2,-m/2,u,m),d.restore(),r}function j(e){J.classList.remove("active"),Y.classList.remove("active"),e.classList.add("active")}yt.addEventListener("click",()=>{if(a.expandedPanel){$();return}a.typingActive=!1,lt.classList.remove("visible"),j(J)});function Ct(e){try{const t=decodeURIComponent(escape(atob(e)));return JSON.parse(t)}catch{return null}}(function(){const t=window.location.hash.slice(1);if(!t)return;const o=Ct(t);o&&(o.n&&(document.getElementById("partner-name").value=o.n,a.partnerName=o.n),o.s&&(document.getElementById("sender-name").value=o.s,a.senderName=o.s),o.d&&(document.getElementById("together-date").value=o.d,a.togetherDate=new Date(o.d+"T00:00:00")),o.l&&(document.getElementById("letter-content").value=o.l,a.letterContent=o.l),a.hasPhotos=!1,mt(),j(Y))})();
