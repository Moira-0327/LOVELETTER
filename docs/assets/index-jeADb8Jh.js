(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function a(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=a(n);fetch(n.href,s)}})();const ft="/lover-letter/assets/paper-texture-CsZFBrw6.png",T=["january","february","march","april","may","june","july","august","september","october","november","december"],o={partnerName:"",senderName:"",togetherDate:null,letterContent:"",photos:[null,null,null,null],typingActive:!1,hasPhotos:!1,expandedPanel:null,letterTyped:!1},V=document.getElementById("setup-screen"),H=document.getElementById("result-screen"),yt=document.getElementById("setup-form"),X=document.getElementById("photo-input-multi"),rt=document.querySelectorAll(".photo-upload-slot"),vt=document.getElementById("back-btn");document.getElementById("flatlay-scene");const xt=document.getElementById("letter-paper"),K=document.getElementById("photobooth-strip-el"),it=document.getElementById("flatlay-actions"),F=document.getElementById("expand-backdrop"),J=document.getElementById("expand-letter-panel"),Z=document.getElementById("expand-photobooth-panel");let b=null,k=null,U=!1,P=null;function Q(){if(b)return b;try{b=new(window.AudioContext||window.webkitAudioContext);const e=b.sampleRate,t=Math.floor(e*.03),a=b.createBuffer(1,t,e),r=a.getChannelData(0);for(let n=0;n<t;n++){const s=n/e,i=Math.exp(-s*150);r[n]=(Math.sin(s*600*6.283)*.4+(Math.random()-.5)*.15)*i*.1}k=a}catch{}if(!P)try{const a=Math.floor(661.5),r=new ArrayBuffer(44+a*2),n=new DataView(r),s=(i,l)=>{for(let d=0;d<l.length;d++)n.setUint8(i+d,l.charCodeAt(d))};s(0,"RIFF"),n.setUint32(4,36+a*2,!0),s(8,"WAVE"),s(12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,1,!0),n.setUint32(24,22050,!0),n.setUint32(28,22050*2,!0),n.setUint16(32,2,!0),n.setUint16(34,16,!0),s(36,"data"),n.setUint32(40,a*2,!0);for(let i=0;i<a;i++){const l=i/22050,d=Math.sin(l*600*6.283)*.3*Math.exp(-l*150);n.setInt16(44+i*2,Math.max(-1,Math.min(1,d))*32767,!0)}P=new Audio(URL.createObjectURL(new Blob([r],{type:"audio/wav"}))),P.volume=.15}catch{}return b}function tt(){const e=Q();if(e&&(e.state==="suspended"?e.resume().then(()=>{U=!0}):U=!0,k))try{const t=e.createBufferSource();t.buffer=k;const a=e.createGain();a.gain.value=.001,t.connect(a),a.connect(e.destination),t.start()}catch{}P&&P.play().then(()=>{P.pause(),P.currentTime=0}).catch(()=>{})}document.addEventListener("touchend",tt,{passive:!0});document.addEventListener("click",tt);document.addEventListener("keydown",tt);function lt(){if(!b||!k){Q();return}if(U&&b.state==="running")try{const e=b.createBufferSource();e.buffer=k,e.connect(b.destination),e.start();return}catch{}if(P)try{P.currentTime=0,P.play().catch(()=>{})}catch{}b.state==="suspended"&&b.resume().then(()=>{U=!0})}const q=document.getElementById("together-date");q.addEventListener("change",()=>{q.classList.toggle("has-value",!!q.value)});wt();let st=!1;document.addEventListener("click",()=>{if(!st)try{const e=Q();e&&e.state==="suspended"&&e.resume(),st=!0}catch{}},{once:!1});function wt(){const e=document.createElement("canvas"),t=200;e.width=t,e.height=t;const a=e.getContext("2d"),r=a.createImageData(t,t);for(let s=0;s<r.data.length;s+=4){const i=190+Math.random()*40;r.data[s]=i,r.data[s+1]=i*.93,r.data[s+2]=i*.82,r.data[s+3]=14}a.putImageData(r,0,0);for(let s=0;s<12;s++)a.fillStyle=`rgba(150,120,70,${.03+Math.random()*.05})`,a.beginPath(),a.arc(Math.random()*t,Math.random()*t,1+Math.random()*3,0,6.283),a.fill();const n=e.toDataURL("image/png");document.querySelectorAll(".paper-grain").forEach(s=>{s.style.backgroundImage=`url(${n})`,s.style.backgroundSize=`${t}px ${t}px`})}document.querySelectorAll('#setup-form input[type="text"], #setup-form input[type="date"], #setup-form textarea').forEach(e=>{e.addEventListener("input",()=>lt())});function ct(e){const t=rt[e],a=t.querySelector(".photo-preview");o.photos[e]?(a.src=o.photos[e],t.classList.add("has-photo")):(a.src="",t.classList.remove("has-photo"))}rt.forEach((e,t)=>{e.addEventListener("click",()=>{o.photos[t]?(o.photos[t]=null,ct(t)):X.click()})});X.addEventListener("change",e=>{const t=Array.from(e.target.files),a=[];for(let n=0;n<4;n++)o.photos[n]===null&&a.push(n);const r=Math.min(t.length,a.length);for(let n=0;n<r;n++){const s=new FileReader,i=a[n];s.onload=l=>{o.photos[i]=l.target.result,ct(i)},s.readAsDataURL(t[n])}X.value=""});yt.addEventListener("submit",e=>{e.preventDefault(),o.partnerName=document.getElementById("partner-name").value.trim(),o.senderName=document.getElementById("sender-name").value.trim();const t=document.getElementById("together-date").value;o.togetherDate=t?new Date(t+"T00:00:00"):new Date,o.letterContent=document.getElementById("letter-content").value.trim(),o.hasPhotos=o.photos.some(a=>a!==null),dt(),Y(H)});function dt(){const e=new Date,t=e.getDate(),a=T[e.getMonth()],r=et(o.togetherDate),n=`${a.toUpperCase().slice(0,3)} ${t}, '${String(e.getFullYear()).slice(2)}`,s=document.getElementById("stamp-date");s&&(s.textContent=n);const i=o.partnerName?`Dear ${o.partnerName},`:"Dear you,",l=o.letterContent||"You are the most beautiful chapter in my story.";document.getElementById("letter-greeting").textContent=i,document.getElementById("letter-body").textContent=l,document.getElementById("letter-sender").textContent=o.senderName?`Yours, ${o.senderName}`:"";const d=String(e.getHours()).padStart(2,"0"),c=String(e.getMinutes()).padStart(2,"0"),p=`sealed at ${d}:${c}`;if(document.getElementById("letter-seal-date").textContent=p,document.getElementById("letter-seal-date").classList.add("visible"),document.getElementById("days-stamp").innerHTML=ut(r,o.togetherDate),document.getElementById("days-stamp").classList.add("visible"),o.hasPhotos){K.style.display="";const L=`${a.toUpperCase().slice(0,3)} ${t}, ${e.getFullYear()}`;document.getElementById("strip-date").textContent=L;const h=o.partnerName&&o.senderName?`${o.senderName} & ${o.partnerName}`:o.partnerName?`me & ${o.partnerName}`:"you & me";document.getElementById("strip-caption").textContent=h,o.photos.forEach((u,v)=>{const w=document.getElementById(`strip-photo-${v}`);u?w.style.backgroundImage=`url(${u})`:w.style.backgroundImage="linear-gradient(135deg, #E8E0D8 0%, #D4C8BC 100%)"})}else K.style.display="none";o.letterTyped=!1,setTimeout(()=>{it.classList.add("visible")},1200)}function ut(e,t){const a=t||new Date,r=`${a.getDate()} ${T[a.getMonth()].toUpperCase().slice(0,3)} ${a.getFullYear()}`;return`<svg class="rect-stamp-svg" viewBox="0 0 200 110" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g opacity="0.7" transform="rotate(-1.5 100 55)">
      <!-- Dotted outer border -->
      <rect x="2" y="2" width="196" height="106" rx="2" stroke="currentColor" stroke-width="1.2" stroke-dasharray="2.5 2.5"/>
      <!-- Double solid inner border -->
      <rect x="10" y="10" width="180" height="90" rx="1" stroke="currentColor" stroke-width="1.5"/>
      <rect x="14" y="14" width="172" height="82" rx="1" stroke="currentColor" stroke-width="0.7"/>
      <!-- Horizontal divider -->
      <line x1="14" y1="62" x2="186" y2="62" stroke="currentColor" stroke-width="0.7"/>
      <!-- Top section -->
      <text x="100" y="38" text-anchor="middle" font-family="'DM Sans',sans-serif" font-size="13" font-weight="500" letter-spacing="3" fill="currentColor">${e} DAYS</text>
      <text x="100" y="55" text-anchor="middle" font-family="'Instrument Serif',Georgia,serif" font-size="13" font-style="italic" letter-spacing="2" fill="currentColor">of Love</text>
      <!-- Bottom section -->
      <text x="100" y="84" text-anchor="middle" font-family="'DM Sans',sans-serif" font-size="11" font-weight="400" letter-spacing="1.5" fill="currentColor">since:  ${r}</text>
    </g>
  </svg>`}function et(e){const a=new Date-e;return Math.max(0,Math.floor(a/(1e3*60*60*24)))}xt.addEventListener("click",()=>{o.expandedPanel||Et()});K.addEventListener("click",()=>{o.expandedPanel||St()});F.addEventListener("click",()=>{$()});J.addEventListener("click",e=>{e.target.closest(".save-btn")||$()});Z.addEventListener("click",e=>{e.target.closest(".save-btn")||$()});document.addEventListener("keydown",e=>{e.key==="Escape"&&(o.expandedPanel?$():H.classList.contains("active")&&(o.typingActive=!1,Y(V)))});function Et(){o.expandedPanel="letter";const e=new Date,t=e.getDate(),a=T[e.getMonth()],r=et(o.togetherDate),n=o.partnerName?`Dear ${o.partnerName},`:"Dear you,",s=o.letterContent||"You are the most beautiful chapter in my story.",i=document.getElementById("expand-stamp-date");i&&(i.textContent=`${a.toUpperCase().slice(0,3)} ${t}, '${String(e.getFullYear()).slice(2)}`);const l=document.getElementById("expand-letter-greeting"),d=document.getElementById("expand-letter-body"),c=document.getElementById("expand-letter-sender"),p=document.getElementById("expand-letter-seal-date"),L=o.senderName?`Yours, ${o.senderName}`:"",h=String(e.getHours()).padStart(2,"0"),u=String(e.getMinutes()).padStart(2,"0"),v=`sealed at ${h}:${u}`,w=document.getElementById("expand-days-stamp");w.innerHTML=ut(r),w.classList.add("visible"),l.textContent="",d.textContent="",c.textContent="",p.textContent="",p.classList.remove("visible"),F.classList.add("active"),J.classList.add("active"),It(l,d,c,p,n,s,L,v)}function St(){o.expandedPanel="photobooth";const e=new Date,t=e.getDate(),r=`${T[e.getMonth()].toUpperCase().slice(0,3)} ${t}, ${e.getFullYear()}`;document.getElementById("expand-strip-date").textContent=r;const n=o.partnerName&&o.senderName?`${o.senderName} & ${o.partnerName}`:o.partnerName?`me & ${o.partnerName}`:"you & me";document.getElementById("expand-strip-caption").textContent=n,o.photos.forEach((s,i)=>{const l=document.getElementById(`expand-strip-photo-${i}`);s?l.style.backgroundImage=`url(${s})`:l.style.backgroundImage="linear-gradient(135deg, #E8E0D8 0%, #D4C8BC 100%)"}),F.classList.add("active"),Z.classList.add("active")}function $(){o.typingActive=!1,o.expandedPanel=null,F.classList.remove("active"),J.classList.remove("active"),Z.classList.remove("active")}async function It(e,t,a,r,n,s,i,l){o.typingActive=!0,await O(500),o.typingActive&&(e.classList.add("typing-cursor"),await z(e,n,50),e.classList.remove("typing-cursor"),o.typingActive&&(await O(400),t.classList.add("typing-cursor"),await z(t,s,40),t.classList.remove("typing-cursor"),o.typingActive&&(i&&(await O(300),a.classList.add("typing-cursor"),await z(a,i,50),a.classList.remove("typing-cursor"),!o.typingActive)||(await O(300),r.textContent=l,r.classList.add("visible"),o.letterTyped=!0))))}function z(e,t,a){return new Promise(r=>{let n=0,s=0;e.textContent="";function i(l){if(!o.typingActive||n>=t.length){e.textContent=t,r();return}if(l>=s){e.textContent+=t.charAt(n),lt();const d=t.charAt(n);let c=a+Math.random()*20-10;d==="."||d==="!"||d==="?"?c+=180:d===","?c+=80:d===`
`&&(c+=120),s=l+c,n++}requestAnimationFrame(i)}requestAnimationFrame(i)})}function O(e){return new Promise(t=>setTimeout(t,e))}const _=new Image;_.src=ft;const bt="#E2D9CC",B="#C0392B",Lt="#C0392B",mt="#961C14";function Dt(e){return new Promise((t,a)=>{const r=new Image;r.onload=()=>t(r),r.onerror=a,r.src=e})}function Pt(e,t,a,r,n,s){const i=Math.max(n/t.width,s/t.height),l=t.width*i,d=t.height*i;e.save(),e.beginPath(),e.rect(a,r,n,s),e.clip(),e.drawImage(t,a+(n-l)/2,r+(s-d)/2,l,d),e.restore()}async function W(e,t){const a=await new Promise(l=>e.toBlob(l,"image/png")),r=document.getElementById("share-toast");if(navigator.share&&navigator.canShare)try{const d={files:[new File([a],t,{type:"image/png"})]};if(navigator.canShare(d)){await navigator.share(d);return}}catch{}const n=URL.createObjectURL(a),s=document.createElement("a");s.download=t,s.href=n,document.body.appendChild(s),s.click(),document.body.removeChild(s),/iPad|iPhone|iPod/.test(navigator.userAgent)?(window.open(n,"_blank"),r.textContent="Long press image to save",r.classList.add("visible"),setTimeout(()=>r.classList.remove("visible"),3e3)):setTimeout(()=>URL.revokeObjectURL(n),5e3)}const x=850,C=1100,m=3;document.getElementById("btn-save").addEventListener("click",async e=>{e.preventDefault(),e.stopPropagation();const t=nt();if(await W(t,"love-letter.png"),o.hasPhotos){const a=await at();await W(a,"photobooth.png")}});document.getElementById("expand-save-letter").addEventListener("click",async e=>{e.preventDefault(),e.stopPropagation();const t=nt();await W(t,"love-letter.png")});document.getElementById("expand-save-photobooth").addEventListener("click",async e=>{e.preventDefault(),e.stopPropagation();const t=await at();await W(t,"photobooth.png")});function nt(){const e=document.createElement("canvas");e.width=x*m,e.height=C*m;const t=e.getContext("2d");if(t.scale(m,m),_.complete&&_.naturalWidth){const D=t.createPattern(_,"repeat");t.fillStyle=D}else t.fillStyle=bt;t.fillRect(0,0,x,C);const a=t.createRadialGradient(x/2,C/2,x*.3,x/2,C/2,x*.7);a.addColorStop(0,"rgba(0,0,0,0)"),a.addColorStop(1,"rgba(140,110,60,0.08)"),t.fillStyle=a,t.fillRect(0,0,x,C);for(let D=0;D<15;D++){const N=Math.random()*x,I=Math.random()*C,R=2+Math.random()*8;t.fillStyle=`rgba(160,130,70,${.02+Math.random()*.04})`,t.beginPath(),t.arc(N,I,R,0,Math.PI*2),t.fill()}const r=80;let n=200;const s=o.partnerName?`Dear ${o.partnerName},`:"Dear you,";t.font='28px "Special Elite", "Courier New", monospace',t.fillStyle=B,t.fillText(s,r,n),n+=50;const i=o.letterContent||"You are the most beautiful chapter in my story.";t.font='22px "Special Elite", "Courier New", monospace',t.fillStyle=B;const l=x-r*2,d=44,c=i.split(`
`);for(const D of c){const N=D.split(" ");let I="";for(const R of N){const ot=I+(I?" ":"")+R;t.measureText(ot).width>l&&I?(t.fillText(I,r,n),n+=d,I=R):I=ot}I&&(t.fillText(I,r,n),n+=d),n+=8}o.senderName&&(n+=20,t.font='22px "Special Elite", "Courier New", monospace',t.fillStyle=B,t.textAlign="right",t.fillText(`Yours, ${o.senderName}`,x-r,n),t.textAlign="left",n+=36);const p=new Date,L=String(p.getHours()).padStart(2,"0"),h=String(p.getMinutes()).padStart(2,"0"),u=`SEALED AT ${L}:${h}`;t.font='18px "Special Elite", "Courier New", monospace',t.fillStyle=B,t.textAlign="right",t.fillText(u,x-r,n),t.textAlign="left";const v="#165dad",w=et(o.togetherDate),f=200,E=110,y=x-r-f-5,g=C-r-E-5,S=o.togetherDate||new Date,G=`${S.getDate()} ${T[S.getMonth()].toUpperCase().slice(0,3)} ${S.getFullYear()}`;t.save(),t.translate(y+f/2,g+E/2),t.rotate(-.06),t.translate(-665,-960),t.strokeStyle=v,t.fillStyle=v;for(let D=0;D<3;D++){const N=(Math.random()-.5)*1.2,I=(Math.random()-.5)*1.2;t.save(),t.translate(N,I),t.globalAlpha=D===0?.65:.12,t.lineWidth=1.2,t.setLineDash([2.5,2.5]),t.strokeRect(y,g,f,E),t.setLineDash([]),t.lineWidth=1.5,t.strokeRect(y+8,g+8,f-16,E-16),t.lineWidth=.7,t.strokeRect(y+12,g+12,f-24,E-24),t.beginPath(),t.moveTo(y+12,g+60),t.lineTo(y+f-12,g+60),t.lineWidth=.7,t.stroke(),t.restore()}t.globalAlpha=.7,t.fillStyle=v,t.textAlign="center",t.textBaseline="middle";const M=y+f/2;t.font='500 13px "DM Sans", sans-serif',t.letterSpacing="3px",t.fillText(`${w} DAYS`,M,g+36),t.letterSpacing="0px",t.font='italic 13px "Instrument Serif", Georgia, serif',t.letterSpacing="2px",t.fillText("of Love",M,g+52),t.letterSpacing="0px",t.font='400 11px "DM Sans", sans-serif',t.letterSpacing="1.5px",t.fillText(`since:  ${G}`,M,g+82),t.letterSpacing="0px",t.globalAlpha=1,t.textAlign="left",t.textBaseline="top",t.restore();const pt=x-r-55,gt=r+15,A=55;t.save(),t.translate(pt,gt),t.rotate(.2),t.strokeStyle=B,t.lineWidth=2,t.beginPath(),t.arc(0,0,A,0,Math.PI*2),t.stroke(),t.lineWidth=1,t.beginPath(),t.arc(0,0,A-7,0,Math.PI*2),t.stroke(),t.lineWidth=1.5,t.beginPath(),t.moveTo(-A-6,0),t.lineTo(-A,0),t.stroke(),t.beginPath(),t.moveTo(A,0),t.lineTo(A+6,0),t.stroke(),t.fillStyle=B,t.font='400 8px "DM Sans", sans-serif',t.textAlign="center",t.textBaseline="middle",t.fillText("LOVE LETTER",0,-16);const j=new Date,ht=`${T[j.getMonth()].toUpperCase().slice(0,3)} ${j.getDate()}, '${String(j.getFullYear()).slice(2)}`;return t.font='500 12px "DM Sans", sans-serif',t.fillText(ht,0,2),t.font='300 7px "DM Sans", sans-serif',t.fillText("NEW YORK, NY",0,18),t.restore(),e}async function at(){const n=Math.round(405),s=12,i=36,l=30+i+n*4+s*3+i+30,d=document.createElement("canvas");d.width=600,d.height=l;const c=d.getContext("2d");c.fillStyle=mt,c.fillRect(0,0,600,l);const p=new Date,L=`${T[p.getMonth()].toUpperCase().slice(0,3)} ${p.getDate()}, ${p.getFullYear()}`;c.font='400 11px "DM Sans", "Helvetica Neue", sans-serif',c.fillStyle="#FDF6F2",c.textAlign="center",c.textBaseline="middle",c.fillText(L,600/2,30+i/2);let h=30+i;for(let v=0;v<4;v++){if(o.photos[v])try{const w=await Dt(o.photos[v]),f=document.createElement("canvas");f.width=540,f.height=n;const E=f.getContext("2d");Pt(E,w,0,0,540,n);const y=E.getImageData(0,0,540,n),g=y.data;for(let S=0;S<g.length;S+=4){const G=.299*g[S]+.587*g[S+1]+.114*g[S+2],M=Math.max(0,Math.min(255,(G-128)*1.15+128));g[S]=g[S+1]=g[S+2]=M}E.putImageData(y,0,0),c.drawImage(f,30,h,540,n)}catch{c.fillStyle="#F5EDE0",c.fillRect(30,h,540,n)}else c.fillStyle="#F5EDE0",c.fillRect(30,h,540,n);h+=n+s}const u=o.partnerName&&o.senderName?`${o.senderName} & ${o.partnerName}`:o.partnerName?`me & ${o.partnerName}`:"you & me";return c.font='400 12px "DM Sans", "Helvetica Neue", sans-serif',c.fillStyle="#FDF6F2",c.textAlign="center",c.textBaseline="middle",c.fillText(u.toUpperCase(),600/2,h-s+i/2),d}document.getElementById("btn-share").addEventListener("click",async e=>{e.preventDefault(),e.stopPropagation();const t=document.getElementById("share-toast"),a=window.location.origin+window.location.pathname;if(navigator.share)try{await navigator.share({title:"Love Letter",url:a});return}catch{}try{await navigator.clipboard.writeText(a),t.textContent="Link copied"}catch{t.textContent=a}t.classList.add("visible"),setTimeout(()=>t.classList.remove("visible"),2200)});document.getElementById("btn-send").addEventListener("click",async e=>{e.stopPropagation();const t=document.getElementById("share-toast"),a=nt();let r=null;o.hasPhotos&&(r=await at());const n=Ct(a,r),s=await new Promise(c=>n.toBlob(c,"image/png"));if(navigator.share&&navigator.canShare){const p={files:[new File([s],"lover-letter.png",{type:"image/png"})],title:"Love Letter"};if(navigator.canShare(p))try{await navigator.share(p);return}catch{}}const i=URL.createObjectURL(s),l=document.createElement("a");l.download="lover-letter.png",l.href=i,document.body.appendChild(l),l.click(),document.body.removeChild(l),/iPad|iPhone|iPod/.test(navigator.userAgent)?(window.open(i,"_blank"),t.textContent="Long press image to save & send",t.classList.add("visible"),setTimeout(()=>t.classList.remove("visible"),3e3)):(t.textContent="Image saved â€” send it to them!",t.classList.add("visible"),setTimeout(()=>t.classList.remove("visible"),2500),setTimeout(()=>URL.revokeObjectURL(i),5e3))});function Ct(e,t){const r=document.createElement("canvas");if(!t){const f=e.width/m+80,E=e.height/m+80;r.width=f*m,r.height=E*m;const y=r.getContext("2d");return y.scale(m,m),y.fillStyle=Lt,y.fillRect(0,0,f,E),y.drawImage(e,0,0,e.width,e.height,40,40,e.width/m,e.height/m),r}const n=e.width/m,s=e.height/m,i=t.width/m,l=t.height/m,d=Math.min(s*.7/l,n*.5/i),c=i*d,p=l*d,L=n+c+120,h=Math.max(s,p)+80;r.width=L*m,r.height=h*m;const u=r.getContext("2d");u.scale(m,m),u.fillStyle=mt,u.fillRect(0,0,L,h),u.save(),u.translate(40+n/2,40+s/2),u.rotate(-.01),u.shadowColor="rgba(0,0,0,0.2)",u.shadowBlur=15,u.shadowOffsetX=4,u.shadowOffsetY=4,u.drawImage(e,0,0,e.width,e.height,-n/2,-s/2,n,s),u.restore(),u.save();const v=80+n+c/2,w=h/2;return u.translate(v,w),u.rotate(.03),u.shadowColor="rgba(0,0,0,0.3)",u.shadowBlur=20,u.shadowOffsetX=5,u.shadowOffsetY=5,u.drawImage(t,0,0,t.width,t.height,-c/2,-p/2,c,p),u.restore(),r}function Y(e){V.classList.remove("active"),H.classList.remove("active"),e.classList.add("active")}vt.addEventListener("click",()=>{if(o.expandedPanel){$();return}o.typingActive=!1,it.classList.remove("visible"),Y(V)});function Tt(e){try{const t=decodeURIComponent(escape(atob(e)));return JSON.parse(t)}catch{return null}}(function(){const t=window.location.hash.slice(1);if(!t)return;const a=Tt(t);a&&(a.n&&(document.getElementById("partner-name").value=a.n,o.partnerName=a.n),a.s&&(document.getElementById("sender-name").value=a.s,o.senderName=a.s),a.d&&(document.getElementById("together-date").value=a.d,o.togetherDate=new Date(a.d+"T00:00:00")),a.l&&(document.getElementById("letter-content").value=a.l,o.letterContent=a.l),o.hasPhotos=!1,dt(),Y(H))})();
